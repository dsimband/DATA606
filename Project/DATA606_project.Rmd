---
title: "DATA 606 Data Project: Causes of Financial Wellbeing"
author: "David Simbandumwe"
output:
  prettydoc::html_pretty:
    theme: architect
    highlight: github
editor_options: 
  chunk_output_type: inline
---


```{r, echo=FALSE, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)

library(utils)

library(tidyverse)
library(tidymodels)
library(textrecipes)
library(discrim)
library(dplyr)
library(plyr)
library(naivebayes)

library(glue)
library(GGally)
library(kableExtra)
library(vip)

```



## Setup

```{r clean, results="hide"}

set.seed(1234)
rm(list=ls())

```



```{r external_functions, results="hide",  error=TRUE}

# Exported data load, tidy function and tibble cleaning
fun_file_name <- glue(getwd(), "/Project/DATA606_Functions.R")
source(fun_file_name, local = knitr::knit_global())

```





# Abstract
Abstract is less than 300 words, free of grammatical errors, summarizes the analysis conducted, has a conclusion and implications

As the importance of financial health of individuals and families continues to grow, people often use the term “financial wellness” to mean the level of a person’s financial health. Financial wellness is a comprehensive, multidimensional concept incorporating financial satisfaction, objective status of financial situation, financial attitudes, and behavior that cannot be assessed through one measure. This chapter discusses the concept and measurement of personal financial wellness and presents “Financial Wellness Diagram.” Future research directions are also discussed.





# Part 1 - Introduction
The research question is clearly stated, can be answered by the data, and the context of the problem clearly explained.

I choose to study the results of the Financial well-being survey. The survey is part of the ongoing research from the Consumer Financial Protection Bureau. It was focused on understanding the factors that support consumer financial well-being in an effort to assist practitioners and policymakers empower more families to lead better financial lives to serve their own goals.



<br>
**The CFPB Financial Well-Being Scale contains the following 10 questions:**

How well does this statement describe you or your situation?

1. I could handle a major unexpected expense
2. I am securing my financial future
3. Because of my money situation, I feel like I will never have the things I want in life*
4. I can enjoy life because of the way I’m managing my money
5. I am just getting by financially*
6. I am concerned that the money I have or will save won’t last*


How often does this statement apply to you?

7. Giving a gift for a wedding, birthday or other occasion would put a strain on my finances for the month*
8. I have money left over at the end of the month
9. I am behind with my finances*
10. My finances control my life*






# Part 2 - Data
Includes appropriate, well-labeled, accurate displays (graphs and tables) of the data.
The appropriate statistical test(s) was used for the data and interpretation was clear.

**Describe the method of data collection.**

The data was collected as part of the Consumer Financial Protection Bureau’s (CFPB) National Financial Well-Being Survey Public Use File (PUF). The PUF is a dataset containing 

(1) data collected in the National Financial Well-Being Survey, 
(2) data about members of the GfK KnowledgePanel collected prior to the survey, and 
(3) data on poverty levels in respondents’ counties of residence.

The National Financial Well-Being Survey was conducted in English and Spanish via web mode between October 27, 2016 and December 5, 2016. Overall, 6,394 surveys were completed: 5,395 from the general population sample and 999 from an oversample of adults aged 62 and older. The survey was designed to represent the adult population of the 50 U.S. states and the District of Columbia. The survey was fielded on the GfK KnowledgePanel®. The KnowledgePanel sample is recruited using address-based sampling and dual-frame landline and cell phone random digit dialing methods.

The PUF was published in 2017.



```{r}

df <- getCleanFile()
cfpb_result1<-lm(cfpb_score ~ . ,data=df)
summary(cfpb_result1)

```






```{r}

cfpb_df <- getReducedCFPBFile()


cfpb_df <- cfpb_df %>% droplevels()


cfpb_df <- cfpb_df %>% filter(cfpb_score > 0 &
                                econ_hh_income != "Refused" &
                                econ_inc_volatility != "Refused" &
                                econ_hh_earners != "Refused" & 
                                econ_emp_status != "Refused" & 
                                econ_savings != "Refused" & 
                                hh_status != "Refused" & 
                                hh_value != "Refused" & 
                                hh_mortgage != "Refused" & 
                                per_health != "Refused" & 
                                hh_arrange != "Refused" & 
                                hh_size != "Refused" & 
                                dem_marital != "Refused" & 
                                dem_age != "Refused" & 
                                dem_edu != "Refused" & 
                                dem_race != "Refused" & 
                                dem_gender != "Refused" & 
                                fin_achieve_goals != "Refused" & 
                                fin_goals != "Refused" &      
                                fin_saving_habit != "Refused" & 
                                fin_frugal != "Refused" & 
                                fin_consult_budget != "Refused" & 
                                fin_follow_budget != "Refused" & 
                                fin_set_goals != "Refused" & 
                                fin_clear_plan != "Refused"
                         )

# analysis
count(cfpb_df$cfpb_score)
count(cfpb_df$econ_hh_income)
count(cfpb_df$econ_inc_volatility)
count(cfpb_df$econ_hh_earners)
count(cfpb_df$econ_emp_status)
count(cfpb_df$econ_savings)
count(cfpb_df$hh_status)
count(cfpb_df$hh_value)
count(cfpb_df$hh_mortgage)
count(cfpb_df$per_health)
count(cfpb_df$hh_arrange)
count(cfpb_df$hh_size)
count(cfpb_df$dem_marital)
count(cfpb_df$dem_age)
count(cfpb_df$dem_edu)
count(cfpb_df$dem_race)
count(cfpb_df$dem_gender)
count(cfpb_df$fin_achieve_goals)
count(cfpb_df$fin_goals)     
count(cfpb_df$fin_saving_habit)
count(cfpb_df$fin_frugal)
count(cfpb_df$fin_consult_budget)
count(cfpb_df$fin_follow_budget)
count(cfpb_df$fin_set_goals)
count(cfpb_df$fin_clear_plan)




```



```{r}

# cfpb
ggplot(cfpb_df,
    aes(cfpb_score, y = stat(density))) +
    geom_histogram(binwidth = 1, alpha = 0.7, bins = 100, color="white",size = 0.1) +
    geom_vline(aes(xintercept = mean(cfpb_score)), linetype = "dashed", color="red", size = 0.5) +
    scale_fill_brewer(palette="Spectral") +
    labs(title = "CFPB Score (cfpb dataset)")
summary(cfpb_df$cfpb_score)

```




# Part 3 - Exploratory data analysis

## fit full model

```{r}

# split data
cfpb_split <- initial_split(cfpb_df, prop = 0.8, strata = cfpb_score)
cfpb_training <-  training(cfpb_split)
cfpb_test <-  testing(cfpb_split)



# fit full model
 # cfpb_result1<-lm(cfpb_score ~ . ,data=cfpb_training)
 # summary(cfpb_result1)
 
 
```





## Stepwise model optimization

```{r}

# stepwise regression
# cfpb_results2<-stats::step(cfpb_result1, direction = "both")


```




```{r, echo=FALSE, results='hide'}


# Bayes information criterion (BIC)
# cfpb_result2<-stats::step(cfpb_result1, k=log(nrow(cfpb_training)))

```






# Part 4 - Inference


## Optimized Model


Model stats
- r-squared for the model is 0.4118
- The residual analysis analysis shows several outliers that are impacting the model


```{r}

# Step:  AIC=22814.15
# cfpb_score ~ econ_hh_income + econ_savings + per_health + dem_age + 
#    fin_achieve_goals + fin_saving_habit + fin_frugal + fin_consult_budget



# Model Specification
lm_model <- linear_reg() %>% 
            set_engine('lm') %>% 
            set_mode('regression')


# Fitting to Trained Data
lm_fit <- lm_model %>% 
          fit(cfpb_score ~ econ_hh_income + econ_savings + per_health + dem_age + 
    fin_achieve_goals + fin_saving_habit + fin_frugal + fin_consult_budget
              
              , data = cfpb_training)


# Explore Training Results
names(lm_fit)
summary(lm_fit$fit)
par(mfrow=c(2,2)) 
plot(lm_fit$fit, pch = 16, col = '#006EA1')


# Data frame of estimated coefficients
tidy(lm_fit)

# Performance metrics on training data
glance(lm_fit)  

# variable importance
vip(lm_fit, num_features=25)

```





```{r}

#predict(lm_fit, new_data = cfpb_test)

cfpb_results <- predict(lm_fit, new_data = cfpb_test) %>% 
                            bind_cols(cfpb_test)

#cfpb_results

# RMSE on test set
rmse(cfpb_results, truth = cfpb_score, estimate = .pred)
rsq(cfpb_results, truth = cfpb_score, estimate = .pred)


```




```{r}

ggplot(data = cfpb_results,
       mapping = aes(x = .pred, y = cfpb_score)) +
  geom_point(color = '#006EA1') +
  geom_smooth(method = lm) +
  geom_abline(intercept = 0, slope = 1, color = 'orange') +
  labs(title = 'Linear Regression Results - CFPB Score',
       x = 'Predicted',
       y = 'Actual')

```


##  demographic model


```{r}

# Step:  AIC=22814.15
# cfpb_score ~ per_health + dem_marital + dem_age + dem_generation + 
#            dem_edu + dem_race +dem_gender   


# Model Specification
lm_model <- linear_reg() %>% 
            set_engine('lm') %>% 
            set_mode('regression')


# Fitting to Trained Data
lm_fit <- lm_model %>% 
          fit(cfpb_score ~ per_health + dem_marital + dem_age + dem_generation + 
                  dem_edu + dem_race + dem_gender 
              
              , data = cfpb_training)


# Explore Training Results
names(lm_fit)
summary(lm_fit$fit)
par(mfrow=c(2,2)) 
plot(lm_fit$fit, pch = 16, col = '#006EA1')


# Data frame of estimated coefficients
tidy(lm_fit)

# Performance metrics on training data
glance(lm_fit)  

# variable importance
vip(lm_fit, num_features=25)

```



## 




```{r}

#predict(lm_fit, new_data = cfpb_test)

cfpb_results <- predict(lm_fit, new_data = cfpb_test) %>% 
                            bind_cols(cfpb_test)

#cfpb_results

# RMSE on test set
rmse(cfpb_results, truth = cfpb_score, estimate = .pred)
rsq(cfpb_results, truth = cfpb_score, estimate = .pred)


```

    

```{r}

ggplot(data = cfpb_results,
       mapping = aes(x = .pred, y = cfpb_score)) +
  geom_point(color = '#006EA1') +
  geom_smooth(method = lm) +
  geom_abline(intercept = 0, slope = 1, color = 'orange') +
  labs(title = 'Linear Regression Results - CFPB Score',
       x = 'Predicted',
       y = 'Actual')

```
    

## financial planning



```{r}

# Step:  AIC=22814.15
# cfpb_score ~ fin_achieve_goals + fin_goals + fin_saving_habit + fin_frugal + 
#                       fin_consult_budget + fin_follow_budget + fin_set_goals + fin_clear_plan   


# Model Specification
lm_model <- linear_reg() %>% 
            set_engine('lm') %>% 
            set_mode('regression')


# Fitting to Trained Data
lm_fit <- lm_model %>% 
          fit(cfpb_score ~ fin_achieve_goals + fin_goals + fin_saving_habit + fin_frugal + fin_consult_budget +             fin_follow_budget + fin_set_goals + fin_clear_plan  
              
              , data = cfpb_training)


# Explore Training Results
names(lm_fit)
summary(lm_fit$fit)
par(mfrow=c(2,2)) 
plot(lm_fit$fit, pch = 16, col = '#006EA1')


# Data frame of estimated coefficients
tidy(lm_fit)

# Performance metrics on training data
glance(lm_fit)  

# variable importance
vip(lm_fit, num_features=25)

```



## 




```{r}

#predict(lm_fit, new_data = cfpb_test)

cfpb_results <- predict(lm_fit, new_data = cfpb_test) %>% 
                            bind_cols(cfpb_test)

#cfpb_results

# RMSE on test set
rmse(cfpb_results, truth = cfpb_score, estimate = .pred)
rsq(cfpb_results, truth = cfpb_score, estimate = .pred)


```

    

```{r}

ggplot(data = cfpb_results,
       mapping = aes(x = .pred, y = cfpb_score)) +
  geom_point(color = '#006EA1') +
  geom_smooth(method = lm) +
  geom_abline(intercept = 0, slope = 1, color = 'orange') +
  labs(title = 'Linear Regression Results - CFPB Score',
       x = 'Predicted',
       y = 'Actual')

```
    




# Part 5 - Conclusion
Conclusion includes a clear answer to the statistical question that is consistent with the data analysis and the method of data collection.


The value of this data set is that I will be able to conduct the initial analysis and look for additional confounders or additional variables that could assist in explaining the difference in financial wellness scores across the surveys. 




# References

There are numerous studies of financial wellness sponsored by financial firms, industry groups and government agencies. I choose to focus on two studies:

- Consumer Financial Protection Bureau - Financial Wellness Survey [*Financial well-being data*](https://www.consumerfinance.gov/data-research/financial-well-being-survey-data/) The PUF survey results can be accessed as a csv file [*Financial well-being survey data*](https://www.consumerfinance.gov/documents/5614/NFWBS_PUF_2016_data.csv)


# Appendix (optional)


Remove this section if you don't have an appendix
